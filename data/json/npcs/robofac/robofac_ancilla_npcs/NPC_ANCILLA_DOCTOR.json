[
  {
    "type": "npc",
    "id": "ancilla_doctor",
    "name_unique": "Doc.  Stevens",
    "gender": "male",
    "class": "NC_ANCILLA_DOCTOR",
    "attitude": 0,
    "mission": 3,
    "chat": "TALK_ANCILLA_DOCTOR",
    "faction": "no_faction"
  },
  {
    "type": "npc_class",
    "id": "NC_ANCILLA_DOCTOR",
    "name": { "str": "Ancilla Doctor" },
    "job_description": "I try to keep this gang in one piece.  It's a full time job.",
    "traits": [ { "group": "NPC_starting_traits" }, { "group": "Appearance_demographics" } ],
    "common": false,
    "bonus_int": { "rng": [ 3, 5 ] },
    "worn_override": "NC_ANCILLA_DOCTOR_worn",
    "carry_override": "NC_ANCILLA_BARKEEP_carry",
    "weapon_override": "NC_ANCILLA_BARKEEP_wield",
    "shopkeeper_item_group": [ { "group": "NC_ANCILLA_DOCTOR_stock", "rigid": true } ],
    "shopkeeper_price_rules": [
      { "group": "NC_ANCILLA_DOCTOR_stock", "premium": 2.0 },
      { "group": "NC_ANCILLA_DOCTOR_EXPENSIVE_ITEMS", "premium": 6.0 },
      { "item": "RobofacCoin", "price": 5000, "fixed_adj": 0 }
    ],
    "skills": [
      {
        "skill": "ALL",
        "level": { "mul": [ { "one_in": 3 }, { "sum": [ { "dice": [ 2, 2 ] }, { "constant": -2 }, { "one_in": 4 } ] } ] }
      },
      { "skill": "firstaid", "bonus": 7 }
    ]
  },
  {
    "type": "item_group",
    "id": "NC_ANCILLA_DOCTOR_worn",
    "subtype": "collection",
    "items": [
      { "item": "jeans" },
      { "item": "boots_combat" },
      { "item": "boxer_briefs" },
      { "item": "tshirt" },
      { "item": "apron_leather" }
    ]
  },
  {
    "type": "item_group",
    "id": "NC_ANCILLA_DOCTOR_stock",
    "subtype": "collection",
    "entries": [
      { "item": "RobofacCoin", "prob": 100, "count": [ 8, 10 ] },
      { "item": "disinfectant", "prob": 100, "count": [ 2, 10 ] },
      { "item": "bandages", "prob": 100, "count": [ 3, 10 ] },
      { "item": "saline", "prob": 100, "count": [ 1, 2 ] },
      { "group": "drugs_emergency", "prob": 100, "count": [ 4, 6 ] },
      { "group": "drugs_analgesic", "prob": 100, "count": [ 2, 4 ] }
    ]
  },
  {
    "type": "item_group",
    "id": "NC_ANCILLA_DOCTOR_EXPENSIVE_ITEMS",
    "subtype": "collection",
    "entries": [
      { "item": "morphine", "prob": 100, "count": 4 },
      { "prob": 100, "group": "antibiotics_bottle_plastic_pill_prescription_15" },
      { "prob": 100, "group": "strong_antibiotic_bottle_plastic_pill_prescription_5" },
      { "item": "anesthetic", "prob": 100 },
      { "prob": 100, "group": "oxycodone_bottle_plastic_pill_prescription_10" },
      { "prob": 100, "group": "codeine_bottle_plastic_pill_painkiller_10" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_ANCILLA_DOCTOR",
    "dynamic_line": {
      "u_has_faction_trust": 10,
      "yes": "Oh, what can I do for you today?",
      "no": {
        "compare_string": [ "yes", { "u_val": "dialogue_ancilla_doctor_first_meet" } ],
        "yes": [
          "Try not to touch anything.  Keeping this place clean is a full time job.",
          { "gendered_line": "I'm free at the moment if you need something.", "relevant_genders": [ "npc" ] },
          "Did you know you can lose a medical license over tax fraud?  Couldn't be me.",
          "You try to use the autodoc alone and I'll let it carve you up.  I'm not kidding."
        ],
        "no": "Clinic is open, yes.  If you need medical assistance, I'm your man."
      }
    },
    "speaker_effect": {
      "effect": [ { "u_add_var": "dialogue_ancilla_doctor_first_meet", "value": "yes" } ],
      "sentinel": "ancilla_doctor_meet"
    },
    "responses": [
      {
        "text": "I'm <u_name>.  I was told to see you about field-testing the new cybernetics.",
        "topic": "TALK_ANCILLA_DOCTOR_INSTALL_INTERFACE_REWARD_A",
        "condition": {
          "and": [
            { "math": [ "hub01_promised_cbm_reward == 1" ] },
            { "not": { "u_has_trait": "CBM_Interface_brain_lesion" } },
            { "not": { "u_has_trait": "Hub01_CBM_Interface" } }
          ]
        }
      },
      {
        "text": "I'm <u_name>.  I was told to see you about replacing my Exodii interface with the updated Hub 01 interface.",
        "topic": "TALK_ANCILLA_DOCTOR_INSTALL_INTERFACE_REWARD_B",
        "condition": {
          "and": [
            { "math": [ "hub01_promised_cbm_reward == 1" ] },
            { "not": { "u_has_trait": "Hub01_CBM_Interface" } },
            { "not": { "u_has_trait": "CBM_Interface_brain_lesion" } },
            { "u_has_trait": "CBM_Interface" }
          ]
        }
      },
      { "text": "What services do you offer?", "topic": "TALK_ANCILLA_DOCTOR_SERVICES" },
      {
        "text": "Could you help me with some bionics?",
        "topic": "TALK_ANCILLA_DOCTOR_BIONICS",
        "condition": { "u_has_trait": "Hub01_CBM_Interface" }
      },
      {
        "text": "So… believe it or not, I've swapped my bionic interfaces.  Let's say I wanted you to swap them again, in favor of a new Hub 01 interface.  What's that gonna cost me?",
        "topic": "TALK_ANCILLA_DOCTOR_SWAP_INTERFACE_AGAIN",
        "condition": { "and": [ { "u_has_trait": "CBM_Interface_brain_lesion" }, { "u_has_trait": "CBM_Interface" } ] }
      },
      {
        "text": "I HAVE A MINOR BRAIN LESION AND NO CBM INTERFACE, WHICH SHOULDN'T BE POSSIBLE!  [IF YOU SEE THIS OPTION IN A NORMAL GAME PLEASE FILE A BUG REPORT]",
        "topic": "TALK_DONE",
        "condition": {
          "and": [
            { "u_has_trait": "CBM_Interface_brain_lesion" },
            { "not": { "u_has_trait": "CBM_Interface" } },
            { "not": { "u_has_trait": "Hub01_CBM_Interface" } }
          ]
        }
      },
      { "text": "I could use your medical assistance.", "topic": "TALK_ANCILLA_DOCTOR_AID" },
      { "text": "I need to trade some medical supplies.", "topic": "TALK_ANCILLA_DOCTOR", "effect": "start_trade" },
      { "text": "Is there anything I can help you with?", "topic": "TALK_ANCILLA_DOCTOR_WORK" },
      { "text": "…", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_SERVICES",
    "type": "talk_topic",
    "dynamic_line": "Primarily I run the new Hub 01 automated medical suite.  DON'T touch the machine.  You might lose a finger.  Or worse.  In any case, I can offer medical services in exchange for HGC, and can trade you medical supplies.  We are also accepting applications for the cutting-edge Hub 01 Cybernetic Enhancements Program, if you're interested.",
    "responses": [
      {
        "text": "What?!  Seriously?  Cybernetics?  Tell me more!",
        "topic": "TALK_ANCILLA_DOCTOR_CYBERNETICS_INFO",
        "condition": {
          "and": [ { "not": { "u_has_trait": "Hub01_CBM_Interface" } }, { "not": { "u_has_trait": "CBM_Interface_brain_lesion" } } ]
        }
      },
      {
        "text": "Actually, I'm <u_name>.  I was told to see you about field-testing the new cybernetics.",
        "topic": "TALK_ANCILLA_DOCTOR_INSTALL_INTERFACE_REWARD_A",
        "condition": {
          "and": [
            { "math": [ "hub01_promised_cbm_reward == 1" ] },
            { "not": { "u_has_trait": "Hub01_CBM_Interface" } },
            { "not": { "u_has_trait": "CBM_Interface_brain_lesion" } }
          ]
        }
      },
      {
        "text": "Actually, I'm <u_name>.  I was told to see you about replacing my Exodii interface with the updated Hub 01 interface.",
        "topic": "TALK_ANCILLA_DOCTOR_INSTALL_INTERFACE_REWARD_B",
        "condition": {
          "and": [
            { "math": [ "hub01_promised_cbm_reward == 1" ] },
            { "u_has_trait": "CBM_Interface" },
            { "not": { "u_has_trait": "CBM_Interface_brain_lesion" } }
          ]
        }
      },
      { "text": "Okay, thanks.", "topic": "TALK_ANCILLA_DOCTOR" },
      { "text": "<end_talking_nevermind>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_CYBERNETICS_INFO",
    "type": "talk_topic",
    "dynamic_line": "&The doc cracks a wry grin.  \"Yup, believe it or not, motherfucker, we can soup you up with some metal and plastic and turn you into a Terminator.  Well, theoretically.  Need the implants, which we're short on.  In any case, Hub 01 graciously provides us all the tech and some supplies.  So, for a DISCOUNTED fee of 20 HGCs, I can install a bionic interface in your brain - totally safe, mind you - and fit you with a power supply, a battery compartment to keep it charged, and an integrated two-way radio.  Crazy shit, huh?\"",
    "responses": [
      {
        "text": "Actually, I'm <u_name>.  I was told to see you about field-testing the new cybernetics.",
        "topic": "TALK_ANCILLA_DOCTOR_INSTALL_INTERFACE_REWARD_A",
        "condition": {
          "and": [ { "math": [ "hub01_promised_cbm_reward == 1" ] }, { "not": { "u_has_trait": "CBM_Interface_brain_lesion" } } ]
        }
      },
      {
        "text": "Actually, I'm <u_name>.  I was told to see you about replacing my Exodii interface with the updated Hub 01 interface.",
        "topic": "TALK_ANCILLA_DOCTOR_INSTALL_INTERFACE_REWARD_B",
        "condition": {
          "and": [
            { "math": [ "hub01_promised_cbm_reward == 1" ] },
            { "u_has_trait": "CBM_Interface" },
            { "not": { "u_has_trait": "CBM_Interface_brain_lesion" } }
          ]
        }
      },
      {
        "text": "[20 HGC - Install Hub 01 CBM interface]  Twenty HGC to turn me into a cyborg?  Let's do it.",
        "condition": { "u_has_items": { "item": "RobofacCoin", "count": 20 } },
        "effect": [
          {
            "if": { "u_has_trait": "CBM_Interface" },
            "then": [
              { "u_lose_trait": "CBM_Interface" },
              { "u_add_trait": "CBM_Interface_brain_lesion" },
              { "math": [ "hub01_found_u_exodii_interface = 1" ] }
            ]
          },
          { "u_add_effect": "narcosis", "duration": "2 hours" },
          { "u_add_effect": "sleep", "duration": "2 hours" },
          { "u_assign_activity": "ACT_CBM_SURGERY", "duration": "2 hours" },
          { "u_add_trait": "Hub01_CBM_Interface" },
          { "u_add_bionic": "bio_power_storage" },
          { "u_add_bionic": "bio_batteries" },
          { "u_add_bionic": "bio_radio" },
          { "u_consume_item": "RobofacCoin", "count": 20, "popup": true }
        ],
        "topic": "TALK_ANCILLA_DOCTOR_INSTALLED_HUB01_INTERFACE"
      },
      { "text": "Maybe later.  Let's talk about something else.", "topic": "TALK_ANCILLA_DOCTOR" },
      { "text": "<end_talking_nevermind>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_INSTALL_INTERFACE_REWARD_A",
    "type": "talk_topic",
    "dynamic_line": "Right, they told me about you.  I guess we owe a lot of this to your efforts, yeah?  So, we can soup you up with some metal and plastic and turn you into a Terminator.  Well, theoretically.  Need the implants, which we're short on.  In any case, Hub 01 graciously provides us all the tech and some supplies.  For you?  No charge.  I can install a bionic interface in your brain - totally safe, mind you - and fit you with a power supply, a battery compartment, and an integrated commlink.  Crazy shit, huh?\"",
    "responses": [
      {
        "text": "[Install Hub 01 CBM interface]  Turn me into a cyborg?  For free?  Let's do it.",
        "effect": [
          {
            "if": { "u_has_trait": "CBM_Interface" },
            "then": [
              { "u_lose_trait": "CBM_Interface" },
              { "u_add_trait": "CBM_Interface_brain_lesion" },
              { "math": [ "hub01_found_u_exodii_interface = 1" ] }
            ]
          },
          { "u_add_effect": "narcosis", "duration": "2 hours" },
          { "u_add_effect": "sleep", "duration": "2 hours" },
          { "u_assign_activity": "ACT_CBM_SURGERY", "duration": "2 hours" },
          { "u_add_trait": "Hub01_CBM_Interface" },
          { "u_add_bionic": "bio_power_storage" },
          { "u_add_bionic": "bio_batteries" },
          { "u_add_bionic": "bio_radio" }
        ],
        "topic": "TALK_ANCILLA_DOCTOR_INSTALLED_HUB01_INTERFACE"
      },
      { "text": "Maybe later.  Let's talk about something else.", "topic": "TALK_ANCILLA_DOCTOR" },
      { "text": "<end_talking_nevermind>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_INSTALL_INTERFACE_REWARD_B",
    "type": "talk_topic",
    "dynamic_line": "Right, they told me about you.  I guess you know the drill and how these things work.  I'll use the machine to take out that hostile Exodii tech, install the upgraded Hub 01 unit, and top you up with some extra power, a battery compartment, and a commlink, if you don't have those already.  The new interface is backwards compatible with the Exodii bionics, so no worries there.  I've been given 10 HGC to pay YOU for the Exodii interface scrap.  Remember, the Hub keeping your old interface is a condition for the surgery, and that old thing would've given you cancer, anyway.  So, good riddance, yeah?  You ready?\"",
    "responses": [
      {
        "text": "[Exchange your Exodii CBM interface for the Hub 01 CBM interface and 10 HGC]  Let's do it.",
        "effect": [
          { "math": [ "hub01_found_u_exodii_interface = 1" ] },
          { "u_add_effect": "narcosis", "duration": "2 hours" },
          { "u_add_effect": "sleep", "duration": "2 hours" },
          { "u_assign_activity": "ACT_CBM_SURGERY", "duration": "2 hours" },
          { "u_lose_trait": "CBM_Interface" },
          { "u_add_trait": "Hub01_CBM_Interface" },
          { "u_add_trait": "CBM_Interface_brain_lesion" },
          { "u_add_bionic": "bio_power_storage" },
          { "u_add_bionic": "bio_batteries" },
          { "u_add_bionic": "bio_radio" },
          { "u_spawn_item": "RobofacCoin", "count": 10 }
        ],
        "topic": "TALK_ANCILLA_DOCTOR_INSTALLED_HUB01_INTERFACE"
      },
      { "text": "Maybe later.  Let's talk about something else.", "topic": "TALK_ANCILLA_DOCTOR" },
      { "text": "<end_talking_nevermind>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_INSTALLED_HUB01_INTERFACE",
    "type": "talk_topic",
    "dynamic_line": {
      "math": [ "hub01_found_u_exodii_interface == 1" ],
      "yes": "&The doc lays you down on the bed and tells you not to move - you're all too familiar with this process, having done it with the Exodii already.  You close your eyes and relax.  In an instant you wake up, now resting in a silent room.\n\nYou reach behind your ear and feel a bandage - underneath is a small metal port, and your fingers can make out several bumps that feel like USB connections.  The doctor sees you and grins.\n\n\"Ah, great, you're up.  All done.  Quite the cyborg already, weren't we?  No worries.  Doc Stevens Junior over here got that old, obsolete tech out without a problem.  The new stuff is ready to go, with the fresh upgrades to boot.  If we get any new implants from the Hub, you'll be free to come by and buy them.  Otherwise, happy to install any you can scavenge from those killer robots.  Just make sure they're packaged and sterile.\"",
      "no": "&The doc lays you down on the bed and tells you not to move.  The last thing you see is the robotic arm of the device slowly descend toward your neck.  A syringe full of some liquid is then plunged into your skin, and you wake up, resting in a silent room.\n\nYou reach behind your ear and feel a bandage - underneath is a small metal port, and your fingers can make out several bumps that feel like USB connections.  The doctor sees you and grins.\n\n\"Ah, great, you're up.  All done.  If we get any new implants from the Hub, you'll be free to come by and buy them.  Otherwise, happy to install any you can scavenge from those killer robots.  Just make sure they're packaged and sterile.\""
    },
    "responses": [
      {
        "text": "Feels about the same.  Thanks, Doc.",
        "condition": { "math": [ "hub01_found_u_exodii_interface == 1" ] },
        "topic": "TALK_DONE"
      },
      {
        "text": "I'm a cyborg now?  Doesn't feel too much different.  Guess I should go experiment with whatever the hell you did to me.  Thanks, I guess.",
        "condition": { "math": [ "hub01_found_u_exodii_interface != 1" ] },
        "topic": "TALK_DONE"
      }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_SWAP_INTERFACE_AGAIN",
    "type": "talk_topic",
    "dynamic_line": "…you what?  Seriously?  I mean, yeah, I can do it again.  But look, I'll give it to you straight:  your brain isn't gonna be the same after.  I'm not even sure you'll live.  I'll tell you what… I'll discount it to 10 HGCs, but I get to keep your shit if you die.  Deal?",
    "responses": [
      {
        "text": "[10 HGC - swap CBM interfaces - MAJOR RISK OF BRAIN DAMAGE]  It's worth the risk.  Swap them!",
        "condition": { "u_has_items": { "item": "RobofacCoin", "count": 10 } },
        "effect": [
          { "u_add_effect": "narcosis", "duration": "2 hours" },
          { "u_add_effect": "sleep", "duration": "2 hours" },
          { "u_assign_activity": "ACT_CBM_SURGERY", "duration": "2 hours" },
          { "u_lose_trait": "CBM_Interface" },
          { "u_lose_trait": "CBM_Interface_brain_lesion" },
          { "u_add_trait": "Hub01_CBM_Interface" },
          { "u_add_trait": "CBM_Interface_brain_lesion_2" },
          { "u_consume_item": "RobofacCoin", "count": 10, "popup": true }
        ],
        "topic": "TALK_ANCILLA_DOCTOR_SWAPPED_INTERFACE_AGAIN"
      },
      { "text": "Maybe later.  Let's talk about something else.", "topic": "TALK_ANCILLA_DOCTOR" },
      { "text": "<end_talking_nevermind>", "topic": "TALK_DONE" }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_SWAPPED_INTERFACE_AGAIN",
    "type": "talk_topic",
    "dynamic_line": "&Everything after that moment is a blur in your memory.  You wake up.  For a moment, you're back in your bed.  Was the cataclysm all a dream?  Then you look around, and see Doc Stevens.  You come to your senses.",
    "responses": [
      {
        "text": "Well, I feel pretty much the same.  Seems like there weren't any complications!",
        "topic": "TALK_ANCILLA_DOCTOR_SWAPPED_INTERFACE_AGAIN_2"
      }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_SWAPPED_INTERFACE_AGAIN_2",
    "type": "talk_topic",
    "dynamic_line": "&Doc Stevens stares at you confusedly.  Then he squints at you.  Then he just shrugs his shoulders.  \"Yeah, what you said… same for me.  I think.\"  Then the doctor's eyes go wide and he raises his eyebrows.  He takes a sharp breath.  Then he turns and walks away.",
    "responses": [ { "text": "…What?", "topic": "TALK_DONE" } ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_AID",
    "type": "talk_topic",
    "dynamic_line": {
      "npc_has_effect": "currently_busy",
      "yes": "Come back later, I need to take care of a few things first.",
      "no": "I can take a look at you or your companions if you have any injuries.  It'll cost you, of course."
    },
    "responses": [
      {
        "text": "[4 HGC, 30m] I need you to patch me up.",
        "topic": "TALK_ANCILLA_DOCTOR_AID_DONE",
        "effect": [ { "u_consume_item": "RobofacCoin", "count": 4 }, "give_aid" ],
        "condition": { "u_has_items": { "item": "RobofacCoin", "count": 4 } }
      },
      {
        "text": "[8 HGC, 1h] I need you to patch my friends up.",
        "topic": "TALK_ANCILLA_DOCTOR_AID_DONE",
        "effect": [ { "u_consume_item": "RobofacCoin", "count": 8 }, "give_all_aid" ],
        "condition": { "u_has_items": { "item": "RobofacCoin", "count": 8 } }
      },
      { "text": "I should be fine.", "topic": "TALK_ANCILLA_DOCTOR" }
    ]
  },
  {
    "id": "TALK_ANCILLA_DOCTOR_BIONICS",
    "type": "talk_topic",
    "dynamic_line": "Sure, what are you looking for?",
    "responses": [
      {
        "text": "I was wondering if you could install a cybernetic implant…",
        "topic": "TALK_DONE",
        "effect": "bionic_install",
        "condition": { "not": { "npc_has_effect": "currently_busy" } }
      },
      {
        "text": "I was wondering if you could install a cybernetic implant in my friend here…",
        "topic": "TALK_DONE",
        "effect": "bionic_install_allies",
        "condition": { "not": { "npc_has_effect": "currently_busy" } }
      },
      {
        "text": "I need help removing an implant…",
        "topic": "TALK_DONE",
        "effect": "bionic_remove",
        "condition": { "not": { "npc_has_effect": "currently_busy" } }
      },
      {
        "text": "I need help removing an implant from one of my friends…",
        "topic": "TALK_DONE",
        "effect": "bionic_remove_allies",
        "condition": { "not": { "npc_has_effect": "currently_busy" } }
      },
      { "text": "<end_talking_nevermind>", "topic": "TALK_NONE" }
    ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_ANCILLA_DOCTOR_BIONICS_DONE",
    "dynamic_line": [
      "Now some protocol tests for brain damage.  Please stare at the light over there…",
      "It might take some days for your nervous system to adapt.  Come back if you experience any concerning symptoms like…",
      "I suggest you take it easy for a few days now."
    ],
    "responses": [ { "text": "…", "topic": "TALK_DONE" } ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_ANCILLA_DOCTOR_AID_DONE",
    "dynamic_line": [
      "Take it easy now, or come back soon.  All the same to me.",
      {
        "gendered_line": "Now try not to do whatever you did again.  No, don't tell me more.",
        "relevant_genders": [ "u" ]
      }
    ],
    "responses": [ { "text": "…", "topic": "TALK_DONE" } ]
  },
  {
    "type": "talk_topic",
    "id": "TALK_ANCILLA_DOCTOR_WORK",
    "dynamic_line": "It takes resources to keep this show running: disinfectant, antibiotics, anesthetics, so on.  I'll give you a great price if you bring any of those.",
    "responses": [ { "text": "I'll keep that in mind.", "topic": "TALK_ANCILLA_DOCTOR" } ]
  }
]
